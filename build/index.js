(()=>{"use strict";var e,n={303:()=>{const e=window.wp.element,n=window.React,o=window.ReactDOM,t=window.ReactJSXRuntime,a=({isOpen:e,children:n})=>e?(0,t.jsx)("div",{className:"k2 modal-overlay",children:(0,t.jsxs)("div",{className:"modal-body",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{class:"modal-content",children:n}),(0,t.jsxs)("div",{className:"modal-footer",children:["Powered by ",(0,t.jsx)("img",{src:window.KKWooData.k2_logo_with_name_img,alt:"Kopo Kopo (Logo)"})]})]})}):null,r=({onCancel:e,onConfirm:o})=>{const a=(0,n.useRef)(null),[r,s]=(0,n.useState)("");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{children:[(0,t.jsx)("h3",{className:"modal-title",children:"Lipa na M-PESA"}),(0,t.jsx)("button",{onClick:e,className:"modal-close-btn","aria-label":"Close modal",children:"Ã—"})]}),(0,t.jsxs)("div",{className:"amount-card",children:[(0,t.jsx)("div",{className:"label",children:"Amount to pay"}),(0,t.jsx)("div",{className:"amount",children:"Ksh 32,000"})]}),(0,t.jsx)("form",{ref:a,children:(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Enter M-PESA phone number"}),(0,t.jsxs)("div",{className:"amount-input",children:[(0,t.jsxs)("span",{className:"country-code",children:[(0,t.jsx)("img",{src:window.KKWooData.kenyan_flag_img,alt:"Kenyan flag",class:"k2"}),(0,t.jsx)("span",{children:" +254"})]}),(0,t.jsx)("input",{type:"text",name:"phone_number",placeholder:"7xx xxx xxx"})]}),(0,t.jsx)("p",{className:"message error",children:r})]})}),(0,t.jsx)("div",{className:"modal-actions",children:(0,t.jsx)("button",{onClick:e=>{e.preventDefault();const n=new FormData(a.current),t=Object.fromEntries(n.entries()),r=t.phone_number?.trim();r?/^\d{9}$/.test(r)?(s(""),o(t)):s("Phone number must be 9 digits."):s("Phone number is required.")},className:"k2 modal-btn modal-btn-confirm",children:"Proceed to pay"})})]})};var s,i;function l(){return l=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var t in o)({}).hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},l.apply(null,arguments)}var c=function(e){return n.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:32,height:32,fill:"none","aria-hidden":"true","aria-label":"Loading","aria-live":"polite"},e),s||(s=n.createElement("path",{stroke:"#6E7888",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M30 16a14 14 0 1 1-28 0 14 14 0 0 1 28 0"})),i||(i=n.createElement("path",{stroke:"#6DEDF7",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M16 2a14 14 0 0 1 14 14"})))};const d=()=>(0,t.jsx)(c,{className:"spinner"});var m,h,p,u,w;function k(){return k=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var t in o)({}).hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},k.apply(null,arguments)}var v=function(e){return n.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",width:80,height:80,fill:"none"},e),m||(m=n.createElement("rect",{width:72,height:72,x:4,y:4,fill:"#EDEEF1",rx:36})),h||(h=n.createElement("rect",{width:72,height:72,x:4,y:4,stroke:"#F7F8F8",strokeWidth:8,rx:36})),p||(p=n.createElement("path",{fill:"#fff",fillRule:"evenodd",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.191,d:"M44.948 22.532H32.757c-.837 0-1.56 0-2.154.048-.628.052-1.253.165-1.854.471a4.76 4.76 0 0 0-2.082 2.082c-.306.6-.419 1.225-.47 1.853-.049.595-.049 1.317-.049 2.154v21.72c0 .837 0 1.56.049 2.154.051.628.164 1.252.47 1.853a4.76 4.76 0 0 0 2.082 2.082c.601.306 1.226.42 1.854.47.594.05 1.316.05 2.154.05h12.191c.837 0 1.56 0 2.154-.05.628-.05 1.252-.164 1.853-.47a4.76 4.76 0 0 0 2.082-2.082c.306-.6.42-1.225.471-1.853.049-.595.048-1.317.048-2.154V29.14c0-.837 0-1.56-.048-2.154-.051-.628-.165-1.252-.47-1.853a4.76 4.76 0 0 0-2.083-2.082c-.6-.306-1.225-.42-1.853-.47-.595-.05-1.317-.05-2.154-.05m-6.096 23.82a2.382 2.382 0 1 0 0 4.764 2.382 2.382 0 0 0 0-4.764",clipRule:"evenodd"})),u||(u=n.createElement("rect",{width:23.257,height:9.918,x:36.947,y:30.472,fill:"#38B64A",rx:2.736})),w||(w=n.createElement("path",{fill:"#fff",d:"m42.689 34.18.458.825-1.192.431 1.192.431-.477.853-.99-.816.21 1.266h-.953l.202-1.266-.982.835-.504-.88 1.192-.432-1.183-.413.468-.843 1.018.807-.211-1.275h.963l-.22 1.275zm4.747 0 .458.825-1.192.431 1.192.431-.477.853-.99-.816.21 1.266h-.953l.202-1.266-.982.835-.504-.88 1.192-.432-1.183-.413.468-.843 1.018.807-.211-1.275h.963l-.22 1.275zm4.747 0 .458.825-1.192.431 1.192.431-.477.853-.99-.816.21 1.266h-.953l.202-1.266-.982.835-.504-.88 1.192-.432-1.183-.413.468-.843 1.018.807-.211-1.275h.963l-.22 1.275zm4.747 0 .458.825-1.192.431 1.192.431-.477.853-.99-.816.21 1.266h-.953l.202-1.266-.982.835-.504-.88 1.192-.432-1.183-.413.468-.843 1.018.807-.21-1.275h.962l-.22 1.275z"})))};const f=({onClose:e})=>(0,t.jsxs)("div",{id:"pin-instruction",children:[(0,t.jsx)(v,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"main-info",children:"Enter your M-PESA PIN when prompted to complete payment"}),(0,t.jsx)("p",{className:"side-note",children:"Please note the message will come from Kopo Kopo"})]}),(0,t.jsx)(d,{}),(0,t.jsx)("div",{className:"modal-actions",children:(0,t.jsx)("button",{onClick:e,className:"k2 modal-btn modal-btn-confirm outline w-full",children:"Close"})})]}),x=["MpesaNumberForm","PinInstruction","Processing","Response","NoResponseInstruction"],g=({emitResponse:e,billing:s,eventRegistration:i})=>{const[l,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)("MpesaNumberForm"),[h,p]=(0,n.useState)(!1),{onPaymentSetup:u}=i;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:'Pay using Lipa na M-Pesa. Modal will appear after clicking "Lipa na M-Pesa".'}),l&&(0,o.createPortal)((0,t.jsxs)(a,{isOpen:l,children:["MpesaNumberForm"==d&&(0,t.jsx)(r,{onCancel:()=>{var n;c(!1),n="MpesaNumberForm",x.includes(n)?m(n):console.warn(`Invalid LNMPaymentStep: ${n}`),p(!1),"function"==typeof window.kkwooPaymentReject&&window.kkwooPaymentReject({type:"error",message:"Payment cancelled by user.",messageContext:"error"}),window.kkwooPaymentResolve=null,window.kkwooPaymentReject=null,e?.error?.({message:"Payment cancelled by user."})},onConfirm:async e=>{(await sendSTKPush(e.phone_number,order_key)).success&&nextstep()}}),"PinInstruction"==d&&(0,t.jsx)(f,{onClose:()=>{c(!1)}})]}),document.body)]})},j=window.fetch;window.fetch=async(...e)=>{const[n,o]=e,t=await j(...e);if(n.includes("/wc/store/v1/checkout")&&"POST"===o?.method)try{const e=await t.clone().json();console.log("Order created:",e),window.latestOrderId=e.id,window.latestOrderKey=e.order_key,window.data=e;const n=new CustomEvent("kkwoo-open-modal");window.dispatchEvent(n)}catch(e){console.warn("Failed to parse checkout response",e)}return t};const{getSetting:y}=window.wc.wcSettings,b=y("kkwoo_data",{});window.addEventListener("DOMContentLoaded",()=>{((n=window.wc.wcBlocksRegistry)=>{var o;const{registerPaymentMethod:a}=n;a({name:"kkwoo",paymentMethodId:"kkwoo",label:(0,t.jsx)("span",{children:b.title}),ariaLabel:b.title,content:(0,e.createElement)(g),edit:(0,e.createElement)("p",{},b.description),canMakePayment:()=>!0,placeOrderButtonLabel:"Lipa na M-Pesa",supports:{features:null!==(o=b.supports)&&void 0!==o?o:[]},payment:()=>({then:e=>{window.kkwooResolvePayment=e,console.log("In payment func");const n=new CustomEvent("kkwoo-open-modal");window.dispatchEvent(n)}})}),window.kkwooRegistered=!0})()})}},o={};function t(e){var a=o[e];if(void 0!==a)return a.exports;var r=o[e]={exports:{}};return n[e](r,r.exports,t),r.exports}t.m=n,e=[],t.O=(n,o,a,r)=>{if(!o){var s=1/0;for(d=0;d<e.length;d++){for(var[o,a,r]=e[d],i=!0,l=0;l<o.length;l++)(!1&r||s>=r)&&Object.keys(t.O).every(e=>t.O[e](o[l]))?o.splice(l--,1):(i=!1,r<s&&(s=r));if(i){e.splice(d--,1);var c=a();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,a,r]},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e={57:0,350:0};t.O.j=n=>0===e[n];var n=(n,o)=>{var a,r,[s,i,l]=o,c=0;if(s.some(n=>0!==e[n])){for(a in i)t.o(i,a)&&(t.m[a]=i[a]);if(l)var d=l(t)}for(n&&n(o);c<s.length;c++)r=s[c],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(d)},o=globalThis.webpackChunkkopo_kopo_for_woocommerce=globalThis.webpackChunkkopo_kopo_for_woocommerce||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))})();var a=t.O(void 0,[350],()=>t(303));a=t.O(a)})();