(()=>{"use strict";var e,o={476:()=>{const e=window.wp.element,o=window.React,n=window.ReactDOM,t=window.ReactJSXRuntime,a=({title:e,isOpen:o,onConfirm:n,onCancel:a,children:s})=>o?(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-body",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("h3",{class:"modal-title",children:e}),(0,t.jsx)("button",{onClick:a,className:"modal-close-btn","aria-label":"Close modal",children:"Ã—"}),(0,t.jsx)("div",{class:"modal-content",children:s}),(0,t.jsx)("div",{className:"modal-actions",children:(0,t.jsx)("button",{onClick:n,className:"modal-btn modal-btn-confirm",children:"Proceed to pay"})})]})}):null,s=({emitResponse:e,billing:s,eventRegistration:i})=>{const[r,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),{onPaymentSetup:w}=i;return(0,o.useEffect)(()=>{const e=()=>l(!0);return window.addEventListener("kkwoo-open-modal",e),()=>window.removeEventListener("kkwoo-open-modal",e)},[]),(0,o.useEffect)(()=>{if("function"!=typeof w)return void console.warn("onPaymentSetup is not available or not a function.");const o=w(()=>{if(!c)return l(!0),d(!0),new Promise((o,n)=>{window.kkwooPaymentResolve=o,window.kkwooPaymentReject=n,e?.error?.({message:"Please complete payment in modal."})})});return()=>o?.()},[c,e,w]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:'Pay using Lipa na M-Pesa. Modal will appear after clicking "Lipa na M-Pesa".'}),r&&(0,n.createPortal)((0,t.jsxs)(a,{title:"Lipa na M-PESA",isOpen:r,onConfirm:async()=>{const o=await(async()=>(await new Promise(e=>setTimeout(e,1e3)),{success:!0,message:"STK Push sent successfully"}))(),n={confirmed:!0,timestamp:(new Date).toISOString(),stkResult:o};l(!1),d(!1),"function"==typeof window.kkwooPaymentResolve&&window.kkwooPaymentResolve({type:"success",meta:{paymentMethodData:n,billingData:n}}),window.kkwooPaymentResolve=null,window.kkwooPaymentReject=null,e?.success?.({paymentMethodData:n})},onCancel:()=>{l(!1),d(!1),"function"==typeof window.kkwooPaymentReject&&window.kkwooPaymentReject({type:"error",message:"Payment cancelled by user.",messageContext:"error"}),window.kkwooPaymentResolve=null,window.kkwooPaymentReject=null,e?.error?.({message:"Payment cancelled by user."})},children:[(0,t.jsx)("p",{children:"This will initiate an M-Pesa STK push to your phone."}),(0,t.jsx)("p",{children:"Please check your phone and enter your M-Pesa PIN to complete the payment."})]}),document.body)]})},{getSetting:i}=window.wc.wcSettings,r=i("kkwoo_data",{});window.addEventListener("DOMContentLoaded",()=>{((o=window.wc.wcBlocksRegistry)=>{var n;const{registerPaymentMethod:a}=o;a({name:"kkwoo",paymentMethodId:"kkwoo",label:(0,t.jsx)("span",{children:r.title}),ariaLabel:r.title,content:(0,e.createElement)(s),edit:(0,e.createElement)("p",{},r.description),canMakePayment:()=>!0,placeOrderButtonLabel:"Lipa na M-Pesa",supports:{features:null!==(n=r.supports)&&void 0!==n?n:[]},payment:()=>({then:e=>{window.kkwooResolvePayment=e;const o=new CustomEvent("kkwoo-open-modal");window.dispatchEvent(o)}})}),window.kkwooRegistered=!0})()})}},n={};function t(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}};return o[e](s,s.exports,t),s.exports}t.m=o,e=[],t.O=(o,n,a,s)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,a,s]=e[d],r=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(t.O).every(e=>t.O[e](n[l]))?n.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(d--,1);var c=a();void 0!==c&&(o=c)}}return o}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,a,s]},t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={57:0,350:0};t.O.j=o=>0===e[o];var o=(o,n)=>{var a,s,[i,r,l]=n,c=0;if(i.some(o=>0!==e[o])){for(a in r)t.o(r,a)&&(t.m[a]=r[a]);if(l)var d=l(t)}for(o&&o(n);c<i.length;c++)s=i[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(d)},n=globalThis.webpackChunkkopo_kopo_for_woocommerce=globalThis.webpackChunkkopo_kopo_for_woocommerce||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})();var a=t.O(void 0,[350],()=>t(476));a=t.O(a)})();